<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watchlist - Stock Sentinel</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <div class="brand-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="brand-text">
                    <span class="brand-name">Stock Sentinel</span>
                    <span class="brand-tagline">AI-POWERED ANALYSIS</span>
                </div>
            </div>
            
            <div class="nav-menu">
                {% if session.user_id %}
                    <div class="nav-links">
                        <a href="{{ url_for('index') }}" class="nav-link">
                            <i class="fas fa-home"></i>
                            <span>Dashboard</span>
                        </a>
                        <a href="{{ url_for('watchlist') }}" class="nav-link active">
                            <i class="fas fa-bookmark"></i>
                            <span>Watchlist</span>
                        </a>
                        <a href="{{ url_for('profile') }}" class="nav-link">
                            <i class="fas fa-user"></i>
                            <span>Profile</span>
                        </a>
                    </div>
                    <div class="nav-user">
                        <div class="user-info">
                            <div class="user-avatar">
                                D
                            </div>
                            <div class="user-details">
                                <span class="user-name">Darsh</span>
                                <span class="user-role">Premium User</span>
                            </div>
                        </div>
                        <a href="{{ url_for('logout') }}" class="logout-btn">
                            <i class="fas fa-sign-out-alt"></i>
                        </a>
                    </div>
                {% else %}
                    <div class="nav-auth">
                        <a href="{{ url_for('login') }}" class="btn btn-outline">Sign In</a>
                        <a href="{{ url_for('register') }}" class="btn btn-primary">Get Started</a>
                    </div>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="flash-container">
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'danger' if category == 'error' else category }}">
                                <div class="alert-icon">
                                    <i class="fas fa-{{ 'exclamation-triangle' if category == 'error' else 'check-circle' if category == 'success' else 'info-circle' }}"></i>
                                </div>
                                <div class="alert-content">
                                    <p>{{ message }}</p>
                                </div>
                                <button class="alert-close" onclick="this.parentElement.remove()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}

            <!-- Page Header -->
            <div class="page-header">
                <div class="header-content">
                    <div class="header-text">
                        <h1 class="page-title">
                            <i class="fas fa-bookmark"></i>
                            Your Watchlist Analysis
                        </h1>
                        <p class="page-subtitle">Track sentiment analysis for your favorite companies</p>
                    </div>
                    <div class="header-actions">
                        <a href="{{ url_for('index') }}" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            Add More Companies
                        </a>
                    </div>
                </div>
            </div>

            {% if watchlist %}
            <!-- Analysis Controls -->
            <div class="analysis-controls">
                <div class="controls-card">
                    <div class="control-group">
                        <label class="control-label">
                            <i class="fas fa-calendar-alt"></i>
                            Analysis Date
                        </label>
                        <form method="GET" class="date-form">
                            <div class="date-input-group">
                                <input type="date" 
                                       name="date" 
                                       value="{{ date_input or '26-09-2025' }}"
                                       class="form-input date-input">
                                <button type="submit" class="btn btn-secondary">
                                    <i class="fas fa-sync-alt"></i>
                                    Update Analysis
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Watchlist Companies -->
            <div class="watchlist-companies-section">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-building"></i>
                        Companies in Watchlist
                    </h3>
                    <div class="section-meta">
                        <span class="company-count">{{ (watchlist|length) or 1 }} companies</span>
                    </div>
                </div>
                
                <div class="companies-grid">
                    {% for company in watchlist %}
                    <div class="company-card">
                        <div class="company-header">
                            <div class="company-info">
                                <div class="company-icon">
                                    {{ company[0].upper() }}
                                </div>
                                <div class="company-details">
                                    <h4 class="company-name">{{ company }}</h4>
                                    <span class="company-type">Public Company</span>
                                </div>
                            </div>
                            <form method="POST" action="{{ url_for('remove_watchlist') }}" class="remove-form">
                                <input type="hidden" name="company" value="{{ company }}">
                                <button type="submit" 
                                        class="remove-btn" 
                                        title="Remove from watchlist"
                                        onclick="return confirm('Remove {{ company }} from your watchlist?')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </form>
                        </div>
                        <div class="company-actions">
                            <a href="{{ url_for('index') }}?company={{ company|urlencode }}&date={{ date_input or '26-09-2025' }}" class="btn btn-outline btn-sm">
                                <i class="fas fa-search"></i>
                                Analyze
                            </a>
                        </div>
                    </div>
                    {% else %}
                    <!-- Sample company card for demo -->
                    <div class="company-card">
                        <div class="company-header">
                            <div class="company-info">
                                <div class="company-icon">
                                    T
                                </div>
                                <div class="company-details">
                                    <h4 class="company-name">TCS</h4>
                                    <span class="company-type">Public Company</span>
                                </div>
                            </div>
                            <form method="POST" action="{{ url_for('remove_watchlist') }}" class="remove-form">
                                <input type="hidden" name="company" value="TCS">
                                <button type="submit" 
                                        class="remove-btn" 
                                        title="Remove from watchlist"
                                        onclick="return confirm('Remove TCS from your watchlist?')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </form>
                        </div>
                        <div class="company-actions">
                            <a href="{{ url_for('index') }}?company=TCS&date=26-09-2025" class="btn btn-outline btn-sm">
                                <i class="fas fa-search"></i>
                                Analyze
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {% if error %}
            <!-- Error State -->
            <div class="error-state">
                <div class="error-card">
                    <div class="error-icon">
                        <i class="fas fa-bookmark"></i>
                    </div>
                    <div class="error-content">
                        <h3>Your Watchlist is Empty</h3>
                        <p>{{ error }}</p>
                        <a href="{{ url_for('index') }}" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            Add Your First Company
                        </a>
                    </div>
                </div>
            </div>
            {% elif results %}
            <!-- Analysis Results -->
            <div class="analysis-results-section">
                <div class="results-header">
                    <h3 class="section-title">
                        <i class="fas fa-chart-bar"></i>
                        Watchlist Analysis for {{ date_input or '26-09-2025' }}
                    </h3>
                </div>
                
                <!-- Summary Stats -->
                <div class="summary-stats">
                    {% set positive_count = results|selectattr("sentiment", "equalto", "Positive")|list|length %}
                    {% set negative_count = results|selectattr("sentiment", "equalto", "Negative")|list|length %}
                    {% set neutral_count = results|selectattr("sentiment", "equalto", "Neutral")|list|length %}
                    
                    <div class="stat-card stat-total">
                        <div class="stat-icon">
                            <i class="fas fa-newspaper"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number">{{ results|length }}</div>
                            <div class="stat-label">Total Articles</div>
                        </div>
                    </div>
                    
                    <div class="stat-card stat-positive">
                        <div class="stat-icon">
                            <i class="fas fa-thumbs-up"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number">{{ positive_count }}</div>
                            <div class="stat-label">Positive</div>
                        </div>
                    </div>
                    
                    <div class="stat-card stat-negative">
                        <div class="stat-icon">
                            <i class="fas fa-thumbs-down"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number">{{ negative_count }}</div>
                            <div class="stat-label">Negative</div>
                        </div>
                    </div>
                    
                    <div class="stat-card stat-neutral">
                        <div class="stat-icon">
                            <i class="fas fa-minus"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number">{{ neutral_count }}</div>
                            <div class="stat-label">Neutral</div>
                        </div>
                    </div>
                </div>

                <!-- News Articles -->
                <div class="news-results">
                    <div class="news-grid">
                        {% for article in results %}
                        <article class="news-card sentiment-{{ article.sentiment.lower() }}">
                            <div class="news-header">
                                <div class="company-tag">
                                    <i class="fas fa-building"></i>
                                    {{ article.company }}
                                </div>
                                <div class="news-date">
                                    <i class="fas fa-clock"></i>
                                    {{ article.date }}
                                </div>
                            </div>
                            
                            <div class="news-content">
                                <h4 class="news-title">{{ article.title }}</h4>
                                <div class="news-source">
                                    <i class="fas fa-globe"></i>
                                    {{ article.reference }}
                                </div>
                            </div>
                            
                            <div class="news-footer">
                                <div class="sentiment-badge sentiment-{{ article.sentiment.lower() }}">
                                    <i class="fas fa-{{ 'thumbs-up' if article.sentiment == 'Positive' else 'thumbs-down' if article.sentiment == 'Negative' else 'minus' }}"></i>
                                    {{ article.sentiment }}
                                </div>
                            </div>
                        </article>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

            {% if not session.user_id %}
            <!-- Auth Required -->
            <div class="auth-required">
                <div class="auth-card">
                    <div class="auth-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <div class="auth-content">
                        <h3>Authentication Required</h3>
                        <p>Please sign in to access your personalized watchlist</p>
                        <div class="auth-actions">
                            <a href="{{ url_for('login') }}" class="btn btn-primary">
                                <i class="fas fa-sign-in-alt"></i>
                                Sign In
                            </a>
                            <a href="{{ url_for('register') }}" class="btn btn-outline">
                                <i class="fas fa-user-plus"></i>
                                Create Account
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </main>

    <!-- Watchlist page uses central stylesheet and script; inline script/style removed -->
</body>
</html>